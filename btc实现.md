## 实现

课程链接：https://www.bilibili.com/video/BV1Vt411X7JF?p=5

### UTXO

**transaction-based ledger**

全节点要维护一个全名为 Unspent Transaction Output的数据结构

- 一个交易，可能有多个输出。A给B和C同时转BTC

作用：检测double spending, 新发布的交易需要先查一下UTXO

UTXO在内存中维护，以便快速检测double spending.

- 每个交易多个输入，多个输出。输入金额=输出金额
- 输入金额也会略大于输出金额，差额作为发布区块的手续费。每隔4年出块奖励减半，所以往后交易手续费也许会提升。
- 没有账户的概念，转账要说明币的来源。

**account-based ledger**

以太坊使用的是基于账户的模式

**挖矿可调整的字段**

- nonce
- 区块产生的时间可做一定的调整
- 根哈希值，每个发布的区块里有铸币交易, CoinBase可以写入任何的内容，比如写人生的感想，那么根哈希值就会跟着变。

**挖矿概率分析**

- 两个矿工的挖矿成功率的比值等于算力的比值

### 比特币总量

21万*50 + 21万*25 +21万*12.5 .... 

= 21万 * 50*(1 + 1/2 + 1/4 ...) 

= 21万* 100 = 2100万

系统中所有比特币总量为2100万

**BTC is secured by mining**

虽然挖矿表面没有实际意义，还费电，但是却保证了系统的安全性

### 安全保证

假如大部分的矿工是诚实的，假如恶意节点有10%

- 恶意节点是否可以偷币。不能，因为没有A的签名，如果硬写到区块链，其他矿工不认。而且出块奖励还丢了。

- 双花问题。恶意节点只能分叉攻击。BTC协议中需要等6个确认，才会认为M->A的交易是不可篡改的，也就是1个小时(10分钟一个区块)。

  ![image-20220117164012479](/Users/trh/Library/Application Support/typora-user-images/image-20220117164012479.png)

- 故意不把合法交易发布到区块。问题不大，也可以写到下一个区块里，交易数目太多，也会有一些交易暂时不写到区块里。
- self mining。挖到区块暂不发布，一直挖。但这样做风险太高，恶意节点的算力是不够的。