## 挖矿

### 难度

H(block header) <= target

BTC出块时间基本保持不变，所以如果矿工越来越多，挖矿难度就会增加。

**出块时间过短**

假如网络传输为几十秒，出块时间为1秒。

- 容易出现分叉。对于系统达成共识没有好处。
- 由于诚实算力的分散，恶意节点更容易分叉攻击，集中算力干坏事。

所以出块时间并不是越短越好

**调整策略**

BTC每2016个区块，调整一次挖矿难度，约为每2周调整一次目标阈值。

```
target = target * actual time / expected time
```

expected time = 2016 * 10分钟

actual time为最近实际产生2016个区块所花的时间

这其实是一个负反馈调节机制。

实际上增大和缩小target最多是4倍

**矿工如何调整target**

target调整是在BTC代码里的，如果恶意节点故意不调整target，那么恶意节点发布的区块，诚实的矿工是不认的。

### 全节点

- 一直在线
- 内存中维护UTXO集合
- 本地磁盘硬盘维护完整的区块信息
- 监听比特币网络上的交易信息，验证每个交易的合法性
- 决定哪些交易会被打包到区块链
- 监听别的矿工挖出来的区块，验证其合法性
- 挖矿。决定沿着哪条链，等长分叉时，选择哪一个分叉

### 轻节点

- 不是一直在线
- 不用保存整个区块链，只需要保存每个区块的块头
- 不用保存全部交易，只保存与自己相关的
- 无法检验大多数交易合法性，只能检验与自己相关的
- 无法检测网上发布的区块的正确性
- 可以验证挖矿难度
- 只能检测哪个是最长链，不知道哪个是最长链

**BTC的安全性**

- 密码学。别人无法伪造签名
- 共识机制。

### 挖矿设备

- 通用计算机挖矿性价比很低
- GPU挖矿，性价比还是低。很多部件仍然闲置，比如浮点数运算。
- ASIC芯片。application specific integerated circuit, 专门为挖矿设计。

### 矿池

挖矿很难，就像买彩票

一个全节点驱动很多矿机，用来解决收入不稳定的问题

- Pool manager。负责其他功能

- Miner。 只负责计算hash值, ASIC芯片只能计算哈希值

**利益如何分配**

- 降低挖矿难度，例如实际需要target前70个位0，实际上分配给矿工的60个位0即可。
- 矿工挖到以后，就将结果提交给矿主。矿主可以用为工作量证明。

**拥有大量矿工的矿主可以发动哪些攻击**

- 分叉攻击，双花攻击
- 不要把51%算力当成绝对门槛，也许20%也可以发动攻击。
- 封锁禁用boycott。可以放弃与A相关的所有交易
- 但不可能盗币，因为没有私钥。

​	

